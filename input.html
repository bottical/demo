<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ </title>
</head>
<body>
  <h2>åå‰ã¨ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›</h2>
  <input type="text" id="name" placeholder="åå‰"/><br><br>
  <input type="text" id="word" placeholder="ãƒ¯ãƒ¼ãƒ‰"/><br><br>
  <button id="submitBtn">é€ä¿¡</button>
  <p id="status"></p>

  <hr />

  <button id="showResultsBtn">çµæœç™ºè¡¨</button>
  <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>

  <h3>ğŸ“ å…¨å“¡ã®å…¥åŠ›ä¸€è¦§</h3>
  <ul id="results"></ul>

  <script type="module">
    // Firebase SDK èª­ã¿è¾¼ã¿
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      doc,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAWZRdhMJgW23A4L-CWZPn30iMoZNCZzjc",
      authDomain: "input-3b872.firebaseapp.com",
      projectId: "input-3b872",
      storageBucket: "input-3b872.firebasestorage.app",
      messagingSenderId: "8756337072",
      appId: "1:8756337072:web:d162fc4f3b5ec53af0de75"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const entriesRef = collection(db, "entries");

    // æŠ•ç¨¿å‡¦ç†
    document.getElementById("submitBtn").addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const word = document.getElementById("word").value.trim();
      const status = document.getElementById("status");

      if (!name || !word) {
        status.textContent = "åå‰ã¨ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      try {
        await addDoc(entriesRef, {
          name,
          word,
          createdAt: new Date()
        });
        status.textContent = "é€ä¿¡ã—ã¾ã—ãŸï¼";
        document.getElementById("name").value = "";
        document.getElementById("word").value = "";
      } catch (e) {
        console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", e);
        status.textContent = "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    });

    // çµæœç™ºè¡¨ï¼ˆæ‰‹å‹•è¡¨ç¤ºï¼‰
    document.getElementById("showResultsBtn").addEventListener("click", async () => {
      const resultsList = document.getElementById("results");
      resultsList.innerHTML = "";

      try {
        const snapshot = await getDocs(query(entriesRef, orderBy("createdAt")));
        snapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.textContent = `${data.name}ï¼š${data.word}`;
          resultsList.appendChild(li);
        });
      } catch (e) {
        console.error("è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:", e);
        document.getElementById("status").textContent = "çµæœè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    });

    // å…¨å‰Šé™¤ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰
    document.getElementById("resetBtn").addEventListener("click", async () => {
      const confirmReset = confirm("ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ");
      if (!confirmReset) return;

      try {
        const snapshot = await getDocs(entriesRef);
        const deletions = snapshot.docs.map(docSnap => deleteDoc(doc(db, "entries", docSnap.id)));
        await Promise.all(deletions);
        document.getElementById("status").textContent = "ãƒªã‚»ãƒƒãƒˆå®Œäº†ã—ã¾ã—ãŸã€‚";
        document.getElementById("results").innerHTML = "";
      } catch (e) {
        console.error("ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:", e);
        document.getElementById("status").textContent = "ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    });
  </script>
</body>
</html>
