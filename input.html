<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>プレイヤーフォーム</title>
  <style>
    body {
      margin: 0;
      padding: 5vw;
      font-family: 'Helvetica', 'Arial', sans-serif;
      background-color: #f4f6f8;
      color: #333;
      box-sizing: border-box;
      text-align: center;
    }

    h2, h3 {
      font-size: 6vw;
      margin-bottom: 4vw;
    }

    input[type="text"] {
      width: 80%;
      padding: 3vw;
      margin: 2vw 0;
      font-size: 4.5vw;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .btn {
      display: inline-block;
      margin: 3vw 2vw;
      padding: 3vw 5vw;
      font-size: 4.5vw;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    .btn:hover {
      background: #1976d2;
    }

    #status {
      font-size: 4vw;
      color: #555;
      margin-top: 2vw;
    }

    ul#results {
      list-style: none;
      padding: 0;
      margin-top: 4vw;
      font-size: 4.5vw;
    }

    ul#results li {
      background: #fff;
      margin: 2vw auto;
      padding: 3vw;
      width: 90%;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    @media (min-width: 600px) {
      h2, h3 {
        font-size: 32px;
      }
      input[type="text"] {
        font-size: 20px;
      }
      .btn {
        font-size: 18px;
      }
      ul#results li {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <h2>名前とワードを入力</h2>
  <input type="text" id="name" placeholder="名前"/><br>
  <input type="text" id="word" placeholder="ワード"/><br>
  <button id="submitBtn" class="btn">送信</button>

  <p id="status"></p>

  <hr style="margin: 5vw 0;" />

  <button id="showResultsBtn" class="btn">結果発表</button>
  <button id="resetBtn" class="btn">リセット</button>

  <h3>全員の入力一覧</h3>
  <ul id="results"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      doc,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAWZRdhMJgW23A4L-CWZPn30iMoZNCZzjc",
      authDomain: "input-3b872.firebaseapp.com",
      projectId: "input-3b872",
      storageBucket: "input-3b872.appspot.com",
      messagingSenderId: "8756337072",
      appId: "1:8756337072:web:d162fc4f3b5ec53af0de75"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const entriesRef = collection(db, "entries");

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const word = document.getElementById("word").value.trim();
      const status = document.getElementById("status");

      if (!name || !word) {
        status.textContent = "名前とワードを入力してください。";
        return;
      }

      try {
        await addDoc(entriesRef, {
          name,
          word,
          createdAt: new Date()
        });
        status.textContent = "送信しました！";
        document.getElementById("name").value = "";
        document.getElementById("word").value = "";
      } catch (e) {
        console.error("送信エラー:", e);
        status.textContent = "送信に失敗しました。";
      }
    });

    document.getElementById("showResultsBtn").addEventListener("click", async () => {
      const resultsList = document.getElementById("results");
      resultsList.innerHTML = "";

      try {
        const snapshot = await getDocs(query(entriesRef, orderBy("createdAt")));
        snapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.textContent = `${data.name}：${data.word}`;
          resultsList.appendChild(li);
        });
      } catch (e) {
        console.error("表示エラー:", e);
        document.getElementById("status").textContent = "結果表示に失敗しました。";
      }
    });

    document.getElementById("resetBtn").addEventListener("click", async () => {
      const confirmReset = confirm("すべてのデータを削除しますか？");
      if (!confirmReset) return;

      try {
        const snapshot = await getDocs(entriesRef);
        const deletions = snapshot.docs.map(docSnap => deleteDoc(doc(db, "entries", docSnap.id)));
        await Promise.all(deletions);
        document.getElementById("status").textContent = "リセット完了しました。";
        document.getElementById("results").innerHTML = "";
      } catch (e) {
        console.error("リセットエラー:", e);
        document.getElementById("status").textContent = "リセットに失敗しました。";
      }
    });
  </script>
</body>
</html>
