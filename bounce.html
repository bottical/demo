<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>6丸バウンスオフ</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --accent:#60a5fa;
      --grid-cols:6; --grid-rows:6; /* ★ 6×6 固定 */
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
      padding:16px;
    }
    .wrap{
      width:min(94vw, 94vh); /* スマホで画面に収まるサイズ */
      max-width:680px;
      aspect-ratio: 1/1;     /* ★ 正方形 */
      background:var(--card);
      border:1px solid #1f2937;
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      padding:10px;
      display:grid;
      grid-template-columns: repeat(var(--grid-cols), 1fr);
      grid-template-rows: repeat(var(--grid-rows), 1fr);
      gap: 8px;
      user-select:none;
      touch-action: manipulation;
      position: relative;
    }
    .dot{
      width:100%;
      aspect-ratio:1/1;
      border-radius:50%;
      box-shadow: inset 0 2px 6px rgba(255,255,255,.12), 0 4px 10px rgba(0,0,0,.35);
      transition: transform .12s ease;
    }

    .ui{
      display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;
      color:var(--muted); font-size:.95rem;
    }
    button{
      appearance:none; border:none; cursor:pointer;
      background:linear-gradient(180deg, #2563eb, #1d4ed8);
      color:white; padding:10px 16px; border-radius:12px; font-weight:600;
      box-shadow: 0 6px 16px rgba(37,99,235,.35);
    }
    button:active{ transform: translateY(1px); }
  </style>
</head>
<body>
  <div class="wrap" id="board" aria-label="6×6 グリッド"></div>
  <div class="ui">
    <button id="reroll" title="新しい形に置き換える">ランダム再生成</button>
  </div>

  <script>
    // ★ 6×6 固定
    const COLS = 6;
    const ROWS = 6;
    const COUNT = 6;   // 丸の数
    const COLORS = [
      ["#34d399","#065f46"], ["#60a5fa","#1e3a8a"], ["#f472b6","#831843"],
      ["#f59e0b","#78350f"], ["#a78bfa","#4c1d95"], ["#f87171","#7f1d1d"],
    ];

    const board = document.getElementById('board');
    const btn = document.getElementById('reroll');

    function rnd(n){ return Math.floor(Math.random()*n); }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=rnd(i+1); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    // 6×6内で連結6マスを生成（上下左右）
    function randomConnectedPositions(count=COUNT){
      let x = rnd(COLS);
      let y = rnd(ROWS);
      const cells = new Set([`${x},${y}`]);
      const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
      let guard = 0;

      while(cells.size < count && guard < 5000){
        guard++;
        const list = Array.from(cells).map(s => s.split(',').map(Number));
        const [cx, cy] = list[rnd(list.length)];
        const [dx, dy] = dirs[rnd(dirs.length)];
        const nx = cx + dx, ny = cy + dy;
        if(nx<0||nx>=COLS||ny<0||ny>=ROWS) continue;
        const key = `${nx},${ny}`;
        if(!cells.has(key)) cells.add(key);
      }
      if(cells.size < count) return randomConnectedPositions(count); // 念のためリトライ
      return Array.from(cells).map(s => s.split(',').map(Number));
    }

    function render(){
      board.innerHTML = "";
      const [fill, dark] = COLORS[rnd(COLORS.length)];
      const accents = shuffle(["#ffffff", fill, dark]);
      const positions = randomConnectedPositions(COUNT);

      positions.forEach(([x,y]) => {
        const d = document.createElement('div');
        d.className = "dot";
        d.style.gridColumn = (x+1);
        d.style.gridRow = (y+1);
        d.style.background = `radial-gradient(circle at 35% 30%, ${accents[0]}, ${fill} 35%, ${dark} 100%)`;
        d.style.border = "1px solid rgba(0,0,0,.35)";
        board.appendChild(d);
      });
    }

    function init(){
      document.documentElement.style.setProperty('--grid-cols', COLS);
      document.documentElement.style.setProperty('--grid-rows', ROWS);
      render();
    }

    // ★ 再生成はボタンのみ & 事前確認ダイアログ
    btn.addEventListener('click', () => {
      const ok = confirm('現在の形を消して新しく生成します。よろしいですか？');
      if(ok) render();
    });

    init();
  </script>
</body>
</html>
