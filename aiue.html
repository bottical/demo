<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>あいうえバトル（匿名・50音・リセット対応）</title>
    <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body { font-family: sans-serif; margin: 0; padding: 20px; }
    h2 { font-size: 1.2em; margin-bottom: 0.5em; }
    form, #entries, #kana-grid, #nav-buttons { margin-bottom: 1.5em; }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      width: 100%;
      display: block;
    }
    #kana-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      max-width: 100%;
    }
    .card-btn {
      width: 50px; height: 50px;
      background: #fff;
      border: 2px solid #888;
      border-radius: 6px;
      font-size: 1.2em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .flipped {
      background: #4caf50; color: white;
    }
    .not-found {
      background: #ccc !important; color: #666 !important;
    }
    #resetBtn {
      background: red; color: white;
      padding: 0.5em 1em; border: none; border-radius: 4px;
      font-size: 1em; cursor: pointer;
    }
    #error { color: red; margin-top: 0.5em; }

    #word-input {
      max-width: 400px;
      margin: 0 auto;
      padding: 0 10px;
    }

    #form-setup {
      width: 100%;
    }

    @media (max-width: 600px) {
      body { padding: 10px; }
      input, button { width: 100%; margin-bottom: 0.5em; }
    }
  </style>
</head>
<body>
  <div id="word-input">
    <h2>プレイヤー設定</h2>
    <form id="form-setup">
      <input id="name" placeholder="プレイヤー名" required />
      <input id="chars" placeholder="最大7文字（あ-ん、ー）" maxlength="7" required />
      <button type="submit">登録</button>
      <div id="error"></div>
    </form>
    <div id="nav-buttons">
      <button id="to-kana">→ ひらがな選択へ</button>
    </div>
  </div>

  <div id="kana-select" style="display:none">
    <h2>エントリー状況</h2>
    <div id="entries"></div>

    <h2>50音表 + 「ー」</h2>
    <div id="kana-grid"></div>

    <button id="resetBtn">全体リセット</button>
    <div id="nav-buttons">
      <button id="to-word">← ワード入力へ戻る</button>
    </div>
  </div>

<script type="module">
  const kanaList = [..."あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんー"];
  const lineBreakAfter = ["お", "こ", "そ", "と", "の", "ほ", "も", "よ", "ろ", "ん"]; // 改行を入れる文字
  const validCharRegex = /^[ぁ-んー]{1,7}$/;

  const kanaGrid = document.getElementById("kana-grid");
  const entriesDiv = document.getElementById("entries");
  const wordInputDiv = document.getElementById("word-input");
  const kanaSelectDiv = document.getElementById("kana-select");
  const form = document.getElementById("form-setup");
  const nameInput = document.getElementById("name");
  const charsInput = document.getElementById("chars");
  const errorDiv = document.getElementById("error");

  let players = {};
  let revealedKana = new Set();

  // ひらがなカード生成
  kanaList.forEach((kana) => {
    const btn = document.createElement("button");
    btn.className = "card-btn";
    btn.textContent = kana;
    btn.addEventListener("click", () => onKanaClick(kana, btn));
    kanaGrid.appendChild(btn);

    if (lineBreakAfter.includes(kana)) {
      const br = document.createElement("div");
      br.style.flexBasis = "100%";
      br.style.height = "0";
      kanaGrid.appendChild(br);
    }
  });

  // ワード登録処理
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const name = nameInput.value.trim();
    const chars = charsInput.value.trim();

    if (!name) {
      errorDiv.textContent = "名前を入力してください";
      return;
    }

    if (!validCharRegex.test(chars)) {
      errorDiv.textContent = "使用できるのは「あ〜ん」と「ー」のみ（最大7文字）です";
      return;
    }

    players[name] = chars;
    nameInput.value = "";
    charsInput.value = "";
    errorDiv.textContent = "";

    renderEntries();
    switchToKana();
  });

  // 画面遷移
  document.getElementById("to-kana").addEventListener("click", switchToKana);
  document.getElementById("to-word").addEventListener("click", () => {
    wordInputDiv.style.display = "block";
    kanaSelectDiv.style.display = "none";
  });

  function switchToKana() {
    wordInputDiv.style.display = "none";
    kanaSelectDiv.style.display = "block";
  }

  // カードを押したときの処理
  function onKanaClick(kana, btn) {
    if (revealedKana.has(kana)) return;

    btn.classList.add("flipped");
    revealedKana.add(kana);

    let found = false;
    for (const player in players) {
      if (players[player].includes(kana)) {
        found = true;
      }
    }

    if (!found) {
      btn.classList.add("not-found");
    }

    renderEntries();
  }

  // エントリー描画
  function renderEntries() {
    entriesDiv.innerHTML = "";
    for (const player in players) {
      const div = document.createElement("div");
      div.innerHTML = `<strong>${player}</strong>: ` +
        [...players[player]].map(ch => revealedKana.has(ch) ? ch : "●").join("");
      entriesDiv.appendChild(div);
    }
  }

  // 全体リセット
  document.getElementById("resetBtn").addEventListener("click", () => {
    revealedKana.clear();
    document.querySelectorAll(".card-btn").forEach(btn => {
      btn.classList.remove("flipped", "not-found");
    });
    renderEntries();
  });
</script>
</body>
</html>
